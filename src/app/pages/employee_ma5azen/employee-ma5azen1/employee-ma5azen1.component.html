<app-header></app-header>
<!-- ✅ Message Overlay -->
<div *ngIf="statusMessage" class="modal-overlay">
  <div class="modal-box" [ngClass]="statusType">
    <div class="icon">
      {{ statusType === 'success' ? '✅' : '❌' }}
    </div>

    <h3
      [style.color]="statusType === 'success' ? '#28a745' : '#dc3545'">
      {{ statusType === 'success' ? 'تمت العملية' : 'تنبيه' }}
    </h3>

    <p>{{ statusMessage }}</p>

    <button class="confirm-btn" (click)="closeStatusMessage()">
      موافق
    </button>
  </div>
</div>

<div class="content d-flex flex-row">
  <aside class="sidebar">
    <h5>
  مرحبًا بك
      <span *ngIf="displayName">، {{ displayName }}</span>
    </h5>

    <ul class="mt-5">
      <li class="active"><a>دفتر المالية</a></li>
      <li><a href="/employee_ma5azen2">كاتب الشطب</a></li>
      <li><a href="employee_ma5azen3">المخزن</a></li>
      <li><a href="/employee_ma5azen4">مخزن الأمين</a></li>
      <li><a href="/employee_ma5azen5">عرض مخزنك </a></li>
    </ul>
  </aside>

  <main class="flex-grow-1">
    <form [formGroup]="inventoryLogForm" (ngSubmit)="onSubmit()" dir="rtl" class="my-5 mx-4">

      <div class="table-section" >
        <h2 class="text-center">دفتر المالية</h2>

        <div class="table-responsive">
          <table class="table table-bordered text-center">
            <thead>
              <tr>
                <th>رقم الإضافة</th>
                <th>اسم الصنف</th>
                <th>الوحدة</th>
                <th>الكمية</th>
                <th>سعر الوحدة</th>
                <th>القيمة</th>
                <th>حالة الصنف</th>
              </tr>
            </thead>

            <tbody formArrayName="tableData">
  <tr *ngFor="let rowGroup of tableData.controls; let i = index" [formGroupName]="i">
    <td><input type="number" min="1" formControlName="additionNumber" class="form-control text-center"></td>
<td style="position: relative;">
  <input
  type="text"
  class="form-control text-center"
  formControlName="itemName"
  placeholder="اكتب اسم الصنف"
  (input)="filterItems(tableData.at(i).get('itemName')?.value, i)"
  (change)="onItemChange(i)"
/>

<div *ngIf="isFormSubmitted() && tableData.at(i).get('itemName')?.invalid" class="text-danger mt-1">
  الرجاء كتابة اسم الصنف
</div>





  <!-- Dropdown -->
  <ul *ngIf="filteredItems[i]?.length"
      class="list-group floating-dropdown">
    <li
      class="list-group-item list-group-item-action"
      *ngFor="let item of filteredItems[i]"
      (click)="selectItem(item, i)">
      {{ item }}
    </li>

    <li
      class="list-group-item list-group-item-action text-primary"
      (click)="selectOther(i)">
      ➕ أخرى
    </li>
  </ul>

</td>




    <td>
  <input type="text" formControlName="unit" class="form-control text-center">
  <div *ngIf="isFormSubmitted() && tableData.at(i).get('unit')?.invalid" class="text-danger mt-1">
    الرجاء كتابة الوحدة
  </div>
</td>

    <td><input type="number" min="1" formControlName="quantity" class="form-control text-center"></td>
    <td><input type="number" min="1" formControlName="unitPrice" class="form-control text-center"></td>
    <td><input type="number" min="1" formControlName="value" class="form-control text-center"></td>
   <td>
  <select formControlName="itemCondition" class="form-select text-center">
    <option value="" disabled>اختر</option>
    <option value="مستهلك">مستهلك</option>
    <option value="مستديم">مستديم</option>
  </select>
  <div *ngIf="isFormSubmitted() && tableData.at(i).get('itemCondition')?.invalid" class="text-danger mt-1">
    الرجاء اختيار حالة الصنف
  </div>
</td>

  </tr>
</tbody>

          </table>
        </div>

        <button type="button" class="remove-row-button" (click)="removeRow()">-</button>
        <button type="button" class="add-row-button" (click)="addRow()">+</button>
      </div>

      <div class="button-section text-center">
       <button type="submit" [disabled]="isSubmitting()" class="submit-btn mt-5">
  {{ isSubmitting() ? 'جاري الحفظ...' : 'حفظ البيانات' }}
</button>


      </div>
    </form>
  </main>
</div>

