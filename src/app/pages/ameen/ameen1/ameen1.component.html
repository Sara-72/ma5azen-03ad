<app-header></app-header>




<div *ngIf="statusMessage" class="status-overlay">
  <div class="status-box" [ngClass]="statusType">
    <div class="mb-3" style="font-size: 4rem;">
       {{ statusType === 'success' ? '✅' : '❌' }}
    </div>

    <h3 class="fw-bold mb-3" [style.color]="statusType === 'success' ? '#28a745' : '#dc3545'">
       {{ statusType === 'success' ? 'تمت العملية' : 'تنبيه' }}
    </h3>

    <p class="fs-5 text-dark">
      {{ statusMessage }}
    </p>

    <button type="button" class="close-btn" (click)="closeStatusMessage()">موافق</button>
  </div>
</div>



<div class="content d-flex flex-row">

    <aside class="sidebar">
    <h5>
  مرحبًا بك
      <span *ngIf="displayName">، {{ displayName }}</span>
    </h5>
    <ul class="mt-5">
      <li class="active"><a>المخزن</a></li>
      <li><a href="/ameen2">دفتر اليومية</a></li>
      <li><a href="/ameen3">أذونات الصرف</a></li>
      <li><a href="/ameen4">دفاتر اليومية</a></li>
      <li><a href="/ameen5">مخزنك</a></li>
      <li><a href="/ameen6">الجرد</a></li>
      <li><a href="/ameen7">عُهد الموظفين</a></li>
    </ul>
  </aside>

  <form [formGroup]="simpleForm" (ngSubmit)="onSubmit()" dir="rtl" class="mt-5 form-part m-auto flex-grow-1 d-flex flex-column align-items-center">

    <div class="table-section">
      <h2 class="text-center">المخزن</h2>

      <div class="table-outer-wrapper">
      <div class="table-responsive custom-scrollbar">
        <table class="table table-bordered text-center">
          <thead>
            <tr>
              <th>الفئة</th>
              <th>الصنف</th>
              <th>حالة الصنف</th>
              <th>الوحدة</th>
              <th>العدد</th>
              <th>التاريخ</th>
            </tr>
          </thead>
          <tbody formArrayName="tableData">
            @for (rowGroup of tableData.controls; track $index) {
            <tr [formGroupName]="$index">
              <td>
                <select formControlName="category" class="form-control">
                  <option value="" disabled selected hidden>اختر فئة</option>
                  @for (category of categories; track category) {
                  <option [value]="category">{{ category }}</option>
                  }
                </select>
              </td>
              <td>
                <select formControlName="item" class="form-control">
                  <option [ngValue]="null" disabled selected hidden>اختر صنف</option>
                  @for (item of availableItemsByRow[$index]; track item) {
                  <option [value]="item">{{ item }}</option>
                  }
                </select>
              </td>
              <td>
                <select formControlName="itemType" class="form-control">
                  <option value="" disabled selected hidden>اختر نوع</option>
                  @for (type of itemTypes; track type) {
                  <option [value]="type">{{ type }}</option>
                  }
                </select>
              </td>
              <td><input formControlName="unit" class="form-control" /></td>
              <td><input type="number" formControlName="count" class="form-control" /></td>

              <td>
        <input type="date" formControlName="entryDate" class="form-control bg-light"/>
      </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      </div>

      <button type="button" class="remove-row-button" (click)="removeRow()">-</button>
      <button type="button" class="add-row-button" (click)="addRow()">+</button>
    </div>

    <button type="submit" [disabled]="isSubmitting() || simpleForm.invalid" class="submit-btn mt-5">
      @if (isSubmitting()) { جاري الحفظ... } @else { حفظ البيانات }
    </button>
  </form>
</div>

