<app-header> </app-header>

<div class="content d-flex flex-row">
  <aside class="sidebar">
    <h5>
      مرحبًا بك
      <!-- <span *ngIf="displayName">، {{ displayName }}</span> -->
    </h5>
    <ul class="mt-5">
      <li><a href="/ameen1">المخزن</a></li>
      <li><a href="/ameen2">دفتر اليومية</a></li>
      <li><a href="/ameen3">أذونات الصرف</a></li>
      <li><a href="/ameen4">دفاتر اليومية</a></li>
      <li><a href="/ameen5">مخزنك</a></li>
      <li><a href="/ameen6">الجرد</a></li>
      <li class="active"><a>عهد الموظفين</a></li>
    </ul>
  </aside>

  <div class="container py-5">
    <div class="header-section text-center mb-5 fade-in">
      <h2 class="title fw-bold">سجل عهد الموظفين</h2>

      <div class="search-container mt-4 mx-auto shadow-3d">
        <div class="input-group">
          <span class="input-group-text bg-white border-0">
            <i class="fas fa-search" style="color: var(--primary-color)"></i>
          </span>
          <input
            type="text"
            class="form-control border-0 shadow-none"
            placeholder="ابحث باسم الموظف أو الصنف..."
            [(ngModel)]="searchTerm"
          />
        </div>
      </div>

    <div class="summary-badge-container mb-5 fade-in mt-3">
  <!-- <div class="summary-badge blue">
    <div class="badge-icon"><i class="fas fa-clock"></i></div>
    <div class="badge-content">
      <span class="count">{{ getStatusCount('pending') }}</span>
      <span class="label">ف انتظار تحديث الحالة</span>
    </div>
  </div> -->

  <div class="summary-badge green">
    <div class="badge-icon"><i class="fas fa-check-double"></i></div>
    <div class="badge-content">
      <span class="count">{{ getStatusCount('received') }}</span>
      <span class="label">تم الاستلام</span>
    </div>
  </div>

  <div class="summary-badge gold">
    <div class="badge-icon"><i class="fas fa-undo-alt"></i></div>
    <div class="badge-content">
      <span class="count">{{ getStatusCount('returned') }}</span>
      <span class="label">تم الاسترجاع</span>
    </div>
  </div>
</div>


    <div
      class="table-card shadow-3d mb-5"
      *ngIf="filteredCustody().length > 0; else noData"
    >
      <div class="table-responsive custom-scrollbar">
        <table class="custom-table align-middle mb-0">
          <thead>
            <tr>
              <th>اسم الموظف</th>
              <th>الصنف المستلم</th>
              <th>الكمية</th>
              <th>تاريخ الاستلام</th>
              <th>حالة العهدة</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of filteredCustody(); let i = index"
              [style.animation-delay]="i * 0.1 + 's'"
              class="row-animate"
            >
              <td class="fw-bold text-dark">{{ item.employeeName }}</td>
              <td>
                <div class="item-cell">
                  {{ item.itemName }}
                </div>
              </td>
              <td>
                <span class="badge-3d-qty">{{ item.quantity }}</span>
              </td>
              <td>{{ item.receivedDate }}</td>
              <td>
                <button
                  class="btn-status-3d clickable"
                  [ngClass]="{
                    'status-pending': item.status === 'pending',
                    'status-received': item.status === 'received',
                    'status-returned': item.status === 'returned'
                  }"
                  (click)="onStatusClick(item)"
                >
                  <i
                    class="fas"
                    [ngClass]="{
                      'fa-check-double': item.status === 'received',
                      'fa-undo-alt': item.status === 'returned'
                    }"
                  ></i>
                  <span class="ms-2">
                    {{
                      item.status === "received"
                        ? "تم الاستلام"
                        : "تم الاسترجاع"
                    }}
                  </span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="text-center d-md-none mt-2 text-muted small">
        <i class="fas fa-arrows-alt-h"></i> اسحب الجدول لليمين أو اليسار
      </div>
    </div>

    <ng-template #noData>
      <div class="no-data-wrapper">
        <div class="text-center">
          <i class="fas fa-layer-group d-block mb-3 empty-icon m-auto " style="color:var(--primary-color)"></i>
          <p class="m-auto fw-bold fs-4 text-muted">
            لا توجد عهد مسجلة حالياً.
          </p>
        </div>
      </div>
    </ng-template>
  </div>
</div>


</div>

<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-3d-card shadow-3d" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>تعديل حالة العهدة</h3>
      <p class="text-muted">الموظف: {{ selectedItem?.employeeName }}</p>
    </div>

    <div class="status-selector-grid">
      <!-- <div
        class="status-option blue"
        [class.active]="tempStatus === 'pending'"
        (click)="tempStatus = 'pending'"
      >
        <i class="fas fa-clock"></i>
        <span>قيد الانتظار</span>
      </div> -->

      <div
        class="status-option green"
        [class.active]="tempStatus === 'received'"
        (click)="tempStatus = 'received'"
      >
        <i class="fas fa-check-double"></i>
        <span>تم الاستلام</span>
      </div>

      <div
        class="status-option gold"
        [class.active]="tempStatus === 'returned'"
        (click)="tempStatus = 'returned'"
      >
        <i class="fas fa-undo-alt"></i>
        <span>تم الاسترجاع</span>
      </div>
    </div>

    <div class="modal-actions">
      <button class="btn-confirm" (click)="confirmStatus()">
        حفظ التغييرات
      </button>
      <button class="btn-cancel" (click)="closeModal()">إلغاء</button>
    </div>
  </div>
</div>

